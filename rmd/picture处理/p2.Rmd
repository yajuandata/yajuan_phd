---
title: "p2"
output: html_document
date: "2023-06-28"
---

加载包
```{r}
library(tidyverse)
library(readxl)
```


blink数据处理
```{r}
nmsg2_list <- list.files("D:/Data/01/nmsg2/", full.names = T)
nmsg2 <- read_csv(nmsg2_list)

stim_info <- function(path, path2){
  data <- read_csv(path)
  
  par <- str_sub(path, start = -12L, end = -5L)
  
  nmsg2 <- nmsg2 %>% filter(participants==par)
  
  f1 <- function(a,b,c,d){
    mutate(data, stim=if_else(between(stime, a, b) & between(etime, a, b), c,NA), pic=if_else(between(stime, a, b) & between(etime, a, b), d, NA)) %>%
      drop_na()
  }

  a <- pmap(list(nmsg2$Stime, nmsg2$Etime, nmsg2$stim, nmsg2$pic), f1) %>% bind_rows()
 write_csv(a, path2) 
  gc()
}
#获取文件列表
file_list<- list.files("D:/Data/01/blinks")

#输入路径列表
blink_list <- str_c("D:/Data/01/blinks/", file_list)


#输出路径
blink_list2 <- str_c("D:/Data/01/blinks2/", file_list)

#建立输出文件夹
dir.create("D:/Data/01/blinks2/")

map2(blink_list, blink_list2, stim_info)
```



